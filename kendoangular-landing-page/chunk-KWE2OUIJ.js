var c=t=>t!=null,O=t=>t==null,d=t=>Array.isArray(t),k=t=>typeof t=="function",b=t=>typeof t=="string";var xt=t=>O(t)||t.trim().length===0,F=t=>!xt(t),D=t=>!isNaN(t-parseFloat(t)),f=t=>t&&t.getTime;var g=t=>c(t.filters);var ht=t=>({"!=":"neq","<":"lt","<=":"lte","==":"eq",">":"gt",">=":"gte",equal:"eq",equals:"eq",equalto:"eq",ge:"gte",greater:"gt",greaterthan:"gt",greaterthanequal:"gte",isempty:"isempty",isequalto:"eq",isgreaterthan:"gt",isgreaterthanorequalto:"gte",islessthan:"lt",islessthanorequalto:"lte",isnotempty:"isnotempty",isnotequalto:"neq",isnull:"isnull",le:"lte",less:"lt",lessthan:"lt",lessthanequal:"lte",ne:"neq",notequal:"neq",notequals:"neq",notequalto:"neq",notsubstringof:"doesnotcontain"})[t.toLowerCase()]||t,Y=t=>{t.filters&&(t.filters=t.filters.map(e=>{let r=Object.assign({},e);return!g(e)&&b(e.operator)&&(r.operator=ht(e.operator)),g(e)&&Y(r),r}))},yt=t=>g(t)?Object.assign({},t):{filters:d(t)?t:[t],logic:"and"},S=t=>(c(t)&&(t=yt(t),Y(t)),t);var q={},dt=/\[(?:(\d+)|['"](.*?)['"])\]|((?:(?!\[.*?\]|\.).)+)/g;q.undefined=t=>t;var m=(t,e)=>{let r=t+e;if(q[r])return q[r];let o=[];return t.replace(dt,(n,s,i,a)=>{o.push(c(s)?s:i||a)}),q[r]=n=>{let s=n;for(let i=0;i<o.length;i++)if(s=s[o[i]],!c(s)&&e)return s;return s},q[r]};var bt={or:{concat:(t,e)=>r=>t(r)||e(r),identity:()=>!1},and:{concat:(t,e)=>r=>t(r)&&e(r),identity:()=>!0}},Ot={contains:(t,e)=>(t||"").indexOf(e)>=0,doesnotcontain:(t,e)=>(t||"").indexOf(e)===-1,doesnotendwith:(t,e)=>(t||"").indexOf(e,(t||"").length-(e||"").length)<0,doesnotstartwith:(t,e)=>(t||"").lastIndexOf(e,0)===-1,endswith:(t,e)=>(t||"").indexOf(e,(t||"").length-(e||"").length)>=0,eq:(t,e)=>t===e,gt:(t,e)=>t>e,gte:(t,e)=>t>=e,isempty:t=>t==="",isnotempty:t=>t!=="",isnotnull:t=>c(t),isnull:t=>O(t),lt:(t,e)=>t<e,lte:(t,e)=>t<=e,neq:(t,e)=>t!=e,startswith:(t,e)=>(t||"").lastIndexOf(e,0)===0},v=/^\/Date\((.*?)\)\/$/,Dt=(t,e)=>{if(t!=null&&b(t)){let r=v.exec(t);if(r)return new Date(+r[1]).getTime();if(e)return t.toLowerCase()}else if(t!=null&&f(t))return t.getTime();return t},St=(t,e,r,o)=>{if(!c(e))return t;let n=t;if(b(e)){let s=v.exec(e);if(s)e=new Date(+s[1]);else{let i=k(o);n=a=>{let l=t(a);if(l===null||i&&d(l))return l;let u=typeof l=="string"?l:l+"";return r?u.toLowerCase():u}}}return f(e)?s=>{let i=n(s);return f(i)?i.getTime():i}:n},At=({field:t,ignoreCase:e,value:r,operator:o})=>{t=c(t)?t:i=>i,e=c(e)?e:!0;let n=St(k(t)?t:m(t,!0),r,e,o);r=Dt(r,e);let s=k(o)?o:Ot[o];return i=>s(n(i),r,e)},T=t=>{let e=bt[t.logic];return t.filters.filter(c).map(r=>g(r)?T(r):At(r)).reduce(e.concat,e.identity)};var N=t=>!t||t.filters.length===0?()=>!0:T(t),R=(t,e)=>!c(e)||g(e)&&e.filters.length===0?t:t.filter(N(S(e)));var qt=t=>(t=c(t)&&t.getTime?t.getTime():t,t+""),K=t=>{let e=m(t,!0),r=0;return(o,n)=>{o[t]=o[t]||{};let s=e(n),i=qt(s),a=o[t][i]||{__position:r++,aggregates:{},items:[],value:s};return a.items.push(n),o[t][i]=a,o}},H=(t={})=>(Object.keys(t).forEach(e=>{let r=t[e];Object.keys(r).forEach(o=>{r[o]=r[o].result()})}),t),Ct=t=>({average:()=>{let e=0,r=0,o=!1,n=null;return{calc:s=>{D(s)?(e+=s,r++,o=!0):!o&&n===null&&(n=s)},result:()=>o?e/r:n}},count:()=>{let e=0;return{calc:()=>e++,result:()=>e}},max:()=>{let e=Number.NEGATIVE_INFINITY;return{calc:r=>{e=D(e)||f(e)?e:r,e<r&&(D(r)||f(r))&&(e=r)},result:()=>e}},min:()=>{let e=Number.POSITIVE_INFINITY;return{calc:r=>{e=D(e)||f(e)?e:r,e>r&&(D(r)||f(r))&&(e=r)},result:()=>e}},sum:()=>{let e=0;return{calc:r=>{r=c(r)?r:0,e+=r},result:()=>e}}})[t](),J=t=>{let e=t.map(r=>{let o=m(r.field,!0),n=(r.aggregate||"").toLowerCase(),s=m(n,!0);return(i,a)=>{let l=i[r.field]||{},u=s(l)||Ct(n);return u.calc(o(a)),l[r.aggregate]=u,i[r.field]=l,i}});return(r,o)=>e.reduce((n,s)=>s(n,o),r)},Q=(t,e)=>(t.push(e),t),$=t=>e=>(r,o,n)=>e(r,t(o,n)),P=t=>e=>(r,o)=>t(o)?e(r,o):r,X=t=>c(t.__value),jt=t=>X(t)?t:{__value:t,reduced:!0},Z=t=>e=>(r,o)=>t-- >0?e(r,o):jt(r);var tt=t=>e=>(r,o)=>t--<=0?e(r,o):r,A=(t,e,r)=>{let o=e;for(let n=0,s=r.length;n<s;n++)if(o=t(o,r[n],n),X(o)){o=o.__value;break}return o};var Et=$(t=>t),I=(t,e=[],r=Et)=>{let o={};if(!e.length)return o;let n=A(r(J(e)),o,t);return H(n)};var z=t=>(t=d(t)?t:[t],t.map(e=>Object.assign({dir:"asc"},e))),et=$(t=>t),C=(t,e=[],r=et,o=t)=>{if(e=z(e),!e.length)return t;let n=e[0],s={},i=A(r(K(n.field)),s,t),a=[];return Object.keys(i).forEach(l=>{Object.keys(i[l]).forEach(u=>{let x=i[l][u],h={},y=o;c(n.aggregates)&&(y=R(o,{field:n.field,ignoreCase:!1,operator:"eq",value:x.value}),h=I(y,n.aggregates)),a[x.__position]={aggregates:h,field:l,items:e.length>1?C(x.items,e.slice(1),et,y):x.items,value:x.value}})}),a};var rt=(t,e)=>O(t)?t===e?0:-1:O(e)?1:t.localeCompare?t.localeCompare(e):t>e?1:t<e?-1:0,wt=(t,e)=>rt(e,t),kt=t=>{if(typeof t.compare=="function")return t.compare;let e=m(t.field,!0);return(r,o)=>(t.dir==="asc"?rt:wt)(e(r),e(o))},Nt=(t,e)=>0,B=t=>t.filter(e=>c(e.dir)||c(e.compare)).map(e=>kt(e)).reduce((e,r)=>(o,n)=>e(o,n)||r(o,n),Nt);var j=(t,e,r)=>o=>t(o)?e(o):r(o),p=(...t)=>e=>t.reduceRight((r,o)=>o(r),e),ot=t=>()=>t;var nt=(t,e)=>{if(e.some(r=>c(r.dir)||c(r.compare))){t=t.slice(0);let r=B(e);t.sort(r)}return t},$t=(t,e)=>t===e,zt=t=>{if(b(t)){let e=m(t);t=(r,o)=>e(r)===e(o)}return t},Ft=(t,e)=>t.filter((r,o,n)=>n.findIndex(e.bind(null,r))===o),Tt=(t,e=$t)=>Ft(t,zt(e)),Rt=(t,e)=>{let r=0;for(let o=0,n=t.length;o<n;o++)e(t[o])&&r++;return r},Pt=(t,e)=>e?t.filter(e):t,It=(t,e)=>{let{skip:r,take:o,filter:n,sort:s,group:i}=e,a=[...z(i||[]),...s||[]];a.length&&(t=nt(t,a));let l=c(n)&&P.length,u=c(i)&&i.length;if(!l&&!u)return{data:o?t.slice(r,r+o):t,total:t.length};let x,h=[],y;if(l?(y=N(S(n)),x=Rt(t,y),h.push(P(y))):x=t.length,c(r)&&c(o)&&(h.push(tt(r)),h.push(Z(o))),h.length){let W=p(...h);return{data:u?C(t,i,W,Pt(t,y)):A(W(Q),[],t),total:x}}return{data:u?C(t,i):t,total:x}};var L=t=>new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));var V=t=>f(t.value);var br=ot("");var E=t=>e=>[t,e],Ut=()=>null,Gt=t=>c(t)&&d(t)&&t.length>0,_=t=>e=>c(t(e)),it=t=>e=>Gt(t(e)),w=(t,e)=>j(t,e,Ut),Mt=({skip:t,take:e})=>Math.floor((t||0)/e)+1,U=(t,e)=>r=>t(r).map(e).join("~"),Wt=t=>e=>e.slice(0,e.indexOf(t)),Yt=t=>p(...t.map(([e,r])=>o=>o.replace(new RegExp(e,"g"),r))),vt=Yt([['"',""],[":","-"]]),Kt=Wt("."),ct=({field:t,dir:e="asc"})=>`${t}-${e}`,Ht=({field:t,aggregate:e})=>`${t}-${e}`,at=m("take"),lt=m("aggregates"),Jt=m("skip"),mt=m("group"),G=m("sort",!0),Qt=U(G,ct),Xt=U(mt,ct),Zt=U(lt,Ht),te=t=>`datetime'${t}'`,ee=p(te,Kt,vt,JSON.stringify,L),re=({field:t,value:e,ignoreCase:r,operator:o})=>({value:ee(e),field:t,ignoreCase:r,operator:o}),oe=t=>Object.assign({},t,{sort:(G(t)||[]).filter(({dir:e})=>F(e))}),ne=p(E("page"),Mt),se=p(E("pageSize"),at),ie=p(E("group"),Xt),ce=p(E("sort"),Qt),ae=p(E("aggregate"),Zt),Er=w(_(Jt),ne),wr=w(_(at),se),kr=w(it(mt),ie),Nr=w(_(lt),ae),$r=p(w(it(G),ce),oe);var st=({field:t,operator:e,value:r})=>`${t}~${e}~${r}`,zr=j(V,p(st,re),st);var ut=(t,e,r)=>(e[t]=r,e),le=t=>t.replace(/(^[A-Z])/g,(e,r)=>r.toLowerCase()),M=t=>e=>{let r=e[t];return c(r)?r:e[le(t)]},Pr=M("Member"),Ir=M("AggregateMethodName"),Br=M("Value"),ft=t=>e=>Object.keys(e).reduce(t.bind(null,e),{}),me=ft((t,e,r)=>ut(r.toLowerCase(),e,t[r])),pe=ft((t,e,r)=>ut(r,e,me(t[r]))),pt=(t,e)=>c(t)?t:e,ue=t=>({aggregates:t.Aggregates||t.aggregates,field:t.Member||t.member||t.field,hasSubgroups:t.HasSubgroups||t.hasSubgroups||!1,items:t.Items||t.items,value:pt(t.Key,pt(t.key,t.value))}),fe=p(({field:t,hasSubgroups:e,value:r,aggregates:o,items:n})=>({aggregates:pe(o),field:t,items:e?n.map(fe):n,value:r}),ue);function ge(t,e,r={}){let o=de;if(r.forceProxy&&!r.proxyURL)throw new Error("No proxyURL is set, but forceProxy is true");r.forceProxy||(xe()&&(o=ye),navigator.msSaveBlob&&(o=he)),o(t,e,r)}var gt=()=>document.createElement("a"),xe=()=>"download"in gt();function he(t,e){let r=t;if(typeof t=="string"){let o=t.split(";base64,"),n=o[0],s=atob(o[1]),i=new Uint8Array(s.length);for(let a=0;a<s.length;a++)i[a]=s.charCodeAt(a);r=new Blob([i.buffer],{type:n})}navigator.msSaveBlob(r,e)}function ye(t,e){let r=t;window.Blob&&t instanceof Blob&&(r=URL.createObjectURL(t));let o=gt();o.download=e,o.href=r;let n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(n),setTimeout(()=>URL.revokeObjectURL(r))}function de(t,e,r){if(!r.proxyURL)return;let o=document.createElement("form");o.setAttribute("action",r.proxyURL),o.setAttribute("method","POST"),o.setAttribute("target",r.proxyTarget||"_self");let n=r.proxyData||{};n.fileName=e;let s=t.split(";base64,");n.contentType=s[0].replace("data:",""),n.base64=s[1];for(let i in n)if(n.hasOwnProperty(i)){let a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",i),a.setAttribute("value",n[i]),o.appendChild(a)}document.body.appendChild(o),o.submit(),document.body.removeChild(o)}var ao=String.fromCharCode;export{g as a,R as b,C as c,nt as d,Tt as e,It as f,ge as g};
