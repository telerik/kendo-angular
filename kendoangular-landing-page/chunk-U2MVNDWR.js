var i=t=>t!=null,O=t=>t==null,D=t=>Array.isArray(t),z=t=>typeof t=="function",d=t=>typeof t=="string";var xt=t=>O(t)||t.trim().length===0,F=t=>!xt(t),b=t=>!isNaN(t-parseFloat(t)),p=t=>t&&t.getTime;var u=t=>i(t.filters);var ht=t=>({"!=":"neq","<":"lt","<=":"lte","==":"eq",">":"gt",">=":"gte",equal:"eq",equals:"eq",equalto:"eq",ge:"gte",greater:"gt",greaterthan:"gt",greaterthanequal:"gte",isempty:"isempty",isequalto:"eq",isgreaterthan:"gt",isgreaterthanorequalto:"gte",islessthan:"lt",islessthanorequalto:"lte",isnotempty:"isnotempty",isnotequalto:"neq",isnull:"isnull",le:"lte",less:"lt",lessthan:"lt",lessthanequal:"lte",ne:"neq",notequal:"neq",notequals:"neq",notequalto:"neq",notsubstringof:"doesnotcontain"})[t.toLowerCase()]||t,Y=t=>{t.filters&&(t.filters=t.filters.map(e=>{let o=Object.assign({},e);return!u(e)&&d(e.operator)&&(o.operator=ht(e.operator)),u(e)&&Y(o),o}))},yt=t=>u(t)?Object.assign({},t):{filters:D(t)?t:[t],logic:"and"},S=t=>(i(t)&&(t=yt(t),Y(t)),t);var q={},dt=/\[(?:(\d+)|['"](.*?)['"])\]|((?:(?!\[.*?\]|\.).)+)/g;q.undefined=t=>t;var l=(t,e)=>{let o=t+e;if(q[o])return q[o];let r=[];return t.replace(dt,(n,c,s,a)=>{r.push(i(c)?c:s||a)}),q[o]=n=>{let c=n;for(let s=0;s<r.length;s++)if(c=c[r[s]],!i(c)&&e)return c;return c},q[o]};var bt={or:{concat:(t,e)=>o=>t(o)||e(o),identity:()=>!1},and:{concat:(t,e)=>o=>t(o)&&e(o),identity:()=>!0}},Ot={contains:(t,e)=>(t||"").indexOf(e)>=0,doesnotcontain:(t,e)=>(t||"").indexOf(e)===-1,doesnotendwith:(t,e)=>(t||"").indexOf(e,(t||"").length-(e||"").length)<0,doesnotstartwith:(t,e)=>(t||"").lastIndexOf(e,0)===-1,endswith:(t,e)=>(t||"").indexOf(e,(t||"").length-(e||"").length)>=0,eq:(t,e)=>t===e,gt:(t,e)=>t>e,gte:(t,e)=>t>=e,isempty:t=>t==="",isnotempty:t=>t!=="",isnotnull:t=>i(t),isnull:t=>O(t),lt:(t,e)=>t<e,lte:(t,e)=>t<=e,neq:(t,e)=>t!=e,startswith:(t,e)=>(t||"").lastIndexOf(e,0)===0},v=/^\/Date\((.*?)\)\/$/,Dt=(t,e)=>{if(t!=null&&d(t)){let o=v.exec(t);if(o)return new Date(+o[1]).getTime();if(e)return t.toLowerCase()}else if(t!=null&&p(t))return t.getTime();return t},St=(t,e,o)=>{if(!i(e))return t;let r=t;if(d(e)){let n=v.exec(e);n?e=new Date(+n[1]):r=c=>{let s=t(c);if(s===null)return s;let a=typeof s=="string"?s:s+"";return o?a.toLowerCase():a}}return p(e)?n=>{let c=r(n);return p(c)?c.getTime():c}:r},At=({field:t,ignoreCase:e,value:o,operator:r})=>{t=i(t)?t:s=>s,e=i(e)?e:!0;let n=St(z(t)?t:l(t,!0),o,e);o=Dt(o,e);let c=z(r)?r:Ot[r];return s=>c(n(s),o,e)},T=t=>{let e=bt[t.logic];return t.filters.filter(i).map(o=>u(o)?T(o):At(o)).reduce(e.concat,e.identity)};var k=t=>!t||t.filters.length===0?()=>!0:T(t),R=(t,e)=>!i(e)||u(e)&&e.filters.length===0?t:t.filter(k(S(e)));var qt=t=>(t=i(t)&&t.getTime?t.getTime():t,t+""),K=t=>{let e=l(t,!0),o=0;return(r,n)=>{r[t]=r[t]||{};let c=e(n),s=qt(c),a=r[t][s]||{__position:o++,aggregates:{},items:[],value:c};return a.items.push(n),r[t][s]=a,r}},H=(t={})=>(Object.keys(t).forEach(e=>{let o=t[e];Object.keys(o).forEach(r=>{o[r]=o[r].result()})}),t),Ct=t=>({average:()=>{let e=0,o=0;return{calc:r=>{b(r)?(e+=r,o++):e=r},result:()=>b(e)?e/o:e}},count:()=>{let e=0;return{calc:()=>e++,result:()=>e}},max:()=>{let e=Number.NEGATIVE_INFINITY;return{calc:o=>{e=b(e)||p(e)?e:o,e<o&&(b(o)||p(o))&&(e=o)},result:()=>e}},min:()=>{let e=Number.POSITIVE_INFINITY;return{calc:o=>{e=b(e)||p(e)?e:o,e>o&&(b(o)||p(o))&&(e=o)},result:()=>e}},sum:()=>{let e=0;return{calc:o=>{o=i(o)?o:0,e+=o},result:()=>e}}})[t](),J=t=>{let e=t.map(o=>{let r=l(o.field,!0),n=(o.aggregate||"").toLowerCase(),c=l(n,!0);return(s,a)=>{let f=s[o.field]||{},x=c(f)||Ct(n);return x.calc(r(a)),f[o.aggregate]=x,s[o.field]=f,s}});return(o,r)=>e.reduce((n,c)=>c(n,r),o)},Q=(t,e)=>(t.push(e),t),N=t=>e=>(o,r,n)=>e(o,t(r,n)),P=t=>e=>(o,r)=>t(r)?e(o,r):o,X=t=>i(t.__value),jt=t=>X(t)?t:{__value:t,reduced:!0},Z=t=>e=>(o,r)=>t-- >0?e(o,r):jt(o);var tt=t=>e=>(o,r)=>t--<=0?e(o,r):o,A=(t,e,o)=>{let r=e;for(let n=0,c=o.length;n<c;n++)if(r=t(r,o[n],n),X(r)){r=r.__value;break}return r};var Et=N(t=>t),I=(t,e=[],o=Et)=>{let r={};if(!e.length)return r;let n=A(o(J(e)),r,t);return H(n)};var $=t=>(t=D(t)?t:[t],t.map(e=>Object.assign({dir:"asc"},e))),et=N(t=>t),C=(t,e=[],o=et,r=t)=>{if(e=$(e),!e.length)return t;let n=e[0],c={},s=A(o(K(n.field)),c,t),a=[];return Object.keys(s).forEach(f=>{Object.keys(s[f]).forEach(x=>{let g=s[f][x],h={},y=r;i(n.aggregates)&&(y=R(r,{field:n.field,ignoreCase:!1,operator:"eq",value:g.value}),h=I(y,n.aggregates)),a[g.__position]={aggregates:h,field:f,items:e.length>1?C(g.items,e.slice(1),et,y):g.items,value:g.value}})}),a};var ot=(t,e)=>O(t)?t===e?0:-1:O(e)?1:t.localeCompare?t.localeCompare(e):t>e?1:t<e?-1:0,wt=(t,e)=>ot(e,t),kt=t=>{if(typeof t.compare=="function")return t.compare;let e=l(t.field,!0);return(o,r)=>(t.dir==="asc"?ot:wt)(e(o),e(r))},Nt=(t,e)=>0,B=t=>t.filter(e=>i(e.dir)||i(e.compare)).map(e=>kt(e)).reduce((e,o)=>(r,n)=>e(r,n)||o(r,n),Nt);var j=(t,e,o)=>r=>t(r)?e(r):o(r),m=(...t)=>e=>t.reduceRight((o,r)=>r(o),e),rt=t=>()=>t;var nt=(t,e)=>{if(e.some(o=>i(o.dir)||i(o.compare))){t=t.slice(0);let o=B(e);t.sort(o)}return t},$t=(t,e)=>t===e,zt=t=>{if(d(t)){let e=l(t);t=(o,r)=>e(o)===e(r)}return t},Ft=(t,e)=>t.filter((o,r,n)=>n.findIndex(e.bind(null,o))===r),Tt=(t,e=$t)=>Ft(t,zt(e)),Rt=(t,e)=>{let o=0;for(let r=0,n=t.length;r<n;r++)e(t[r])&&o++;return o},Pt=(t,e)=>e?t.filter(e):t,It=(t,e)=>{let{skip:o,take:r,filter:n,sort:c,group:s}=e,a=[...$(s||[]),...c||[]];a.length&&(t=nt(t,a));let f=i(n)&&P.length,x=i(s)&&s.length;if(!f&&!x)return{data:r?t.slice(o,o+r):t,total:t.length};let g,h=[],y;if(f?(y=k(S(n)),g=Rt(t,y),h.push(P(y))):g=t.length,i(o)&&i(r)&&(h.push(tt(o)),h.push(Z(r))),h.length){let W=m(...h);return{data:x?C(t,s,W,Pt(t,y)):A(W(Q),[],t),total:g}}return{data:x?C(t,s):t,total:g}};var L=t=>new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));var V=t=>p(t.value);var Oo=rt("");var E=t=>e=>[t,e],Ut=()=>null,Gt=t=>i(t)&&D(t)&&t.length>0,_=t=>e=>i(t(e)),it=t=>e=>Gt(t(e)),w=(t,e)=>j(t,e,Ut),Mt=({skip:t,take:e})=>Math.floor((t||0)/e)+1,U=(t,e)=>o=>t(o).map(e).join("~"),Wt=t=>e=>e.slice(0,e.indexOf(t)),Yt=t=>m(...t.map(([e,o])=>r=>r.replace(new RegExp(e,"g"),o))),vt=Yt([['"',""],[":","-"]]),Kt=Wt("."),ct=({field:t,dir:e="asc"})=>`${t}-${e}`,Ht=({field:t,aggregate:e})=>`${t}-${e}`,at=l("take"),lt=l("aggregates"),Jt=l("skip"),mt=l("group"),G=l("sort",!0),Qt=U(G,ct),Xt=U(mt,ct),Zt=U(lt,Ht),te=t=>`datetime'${t}'`,ee=m(te,Kt,vt,JSON.stringify,L),oe=({field:t,value:e,ignoreCase:o,operator:r})=>({value:ee(e),field:t,ignoreCase:o,operator:r}),re=t=>Object.assign({},t,{sort:(G(t)||[]).filter(({dir:e})=>F(e))}),ne=m(E("page"),Mt),se=m(E("pageSize"),at),ie=m(E("group"),Xt),ce=m(E("sort"),Qt),ae=m(E("aggregate"),Zt),wo=w(_(Jt),ne),ko=w(_(at),se),No=w(it(mt),ie),$o=w(_(lt),ae),zo=m(w(it(G),ce),re);var st=({field:t,operator:e,value:o})=>`${t}~${e}~${o}`,Fo=j(V,m(st,oe),st);var ut=(t,e,o)=>(e[t]=o,e),le=t=>t.replace(/(^[A-Z])/g,(e,o)=>o.toLowerCase()),M=t=>e=>{let o=e[t];return i(o)?o:e[le(t)]},Io=M("Member"),Bo=M("AggregateMethodName"),Lo=M("Value"),ft=t=>e=>Object.keys(e).reduce(t.bind(null,e),{}),me=ft((t,e,o)=>ut(o.toLowerCase(),e,t[o])),pe=ft((t,e,o)=>ut(o,e,me(t[o]))),pt=(t,e)=>i(t)?t:e,ue=t=>({aggregates:t.Aggregates||t.aggregates,field:t.Member||t.member||t.field,hasSubgroups:t.HasSubgroups||t.hasSubgroups||!1,items:t.Items||t.items,value:pt(t.Key,pt(t.key,t.value))}),fe=m(({field:t,hasSubgroups:e,value:o,aggregates:r,items:n})=>({aggregates:pe(r),field:t,items:e?n.map(fe):n,value:o}),ue);function ge(t,e,o={}){let r=de;if(o.forceProxy&&!o.proxyURL)throw new Error("No proxyURL is set, but forceProxy is true");o.forceProxy||(xe()&&(r=ye),navigator.msSaveBlob&&(r=he)),r(t,e,o)}var gt=()=>document.createElement("a"),xe=()=>"download"in gt();function he(t,e){let o=t;if(typeof t=="string"){let r=t.split(";base64,"),n=r[0],c=atob(r[1]),s=new Uint8Array(c.length);for(let a=0;a<c.length;a++)s[a]=c.charCodeAt(a);o=new Blob([s.buffer],{type:n})}navigator.msSaveBlob(o,e)}function ye(t,e){let o=t;window.Blob&&t instanceof Blob&&(o=URL.createObjectURL(t));let r=gt();r.download=e,r.href=o;let n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n),setTimeout(()=>URL.revokeObjectURL(o))}function de(t,e,o){if(!o.proxyURL)return;let r=document.createElement("form");r.setAttribute("action",o.proxyURL),r.setAttribute("method","POST"),r.setAttribute("target",o.proxyTarget||"_self");let n=o.proxyData||{};n.fileName=e;let c=t.split(";base64,");n.contentType=c[0].replace("data:",""),n.base64=c[1];for(let s in n)if(n.hasOwnProperty(s)){let a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",s),a.setAttribute("value",n[s]),r.appendChild(a)}document.body.appendChild(r),r.submit(),document.body.removeChild(r)}var lr=String.fromCharCode;export{u as a,R as b,C as c,nt as d,Tt as e,It as f,ge as g};
